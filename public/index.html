<!DOCTYPE html>
<html>
	<head>
		<title>URL Shortner</title>
		<!-- <link rel="icon" type="image/png" href="https://i.imgur.com/P5A06kx.png" /> -->

		<style type="text/css">
			body {
				min-height: 100vh;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
			}

			

			main {
				width: 100%;
				flex: 1 0 auto;
			}

			footer {
				width: 100%;
			}

			div.card-panel {
				margin-top: 16px;
			}

			form {
				padding: 16px;
			}

			.top {
				padding: 16px;
			}

           
		</style>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

		<!--Import Google Icon Font-->
		<link
			href="https://fonts.googleapis.com/icon?family=Material+Icons"
			rel="stylesheet"
		/>
		<!-- Compiled and minified CSS -->
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
		/>       
		<!--Let browser know website is optimized for mobile-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	</head>
	<body>
		<main>
		
			<div class="container">  
				<div class="row">
					<div class="col s12 offset-m2 m8 offset-l3 l6 card-panel hoverable">
						<form id="form_url_short" action="">
							<div style="padding-bottom: 8px;">
								<h5>
									<i class="material-icons">short_text</i> URL Shortner
								</h5>
							</div>
							<div class="input-field">
								<i class="material-icons prefix">link</i>            
								<input type="url" id="inp_url" placeholder="Long URL">
								<!-- <label for="inp_url">Long url</label> -->
							</div>
                           
							<div class="right-align">
								<button
									class="btn-small waves-effect waves-light"
									type="submit" 
								>
									Shorten
									<i class="material-icons right">send</i>
								</button>
							</div>
                            


							
							<div id="result" ></div>
                            <!-- <div class="left-align" >
								<button
									class="btn-small waves-effect waves-light"
									type="reset" 
								>
									Copy
									<i class="material-icons right">content_copy</i>
								</button>
							</div> -->
							<div class="left-align" >
								<!-- <div > -->
									<!-- <i class="fa fa-facebook icon"></i>  -->
									<!-- <i class="material-icons right">content_copy</i> -->
							<div class="btn-small waves-effect waves-light">
							<input
							type="button" id="btns2"
								
								value="Copy" class=" waves-light"
								
								
							>
							<i class="material-icons right">content_copy</i>
						</div>
								
								
							<!-- </button> -->
						<!-- </div> -->
						</div>
						</form> 
					</div>
				</div>

                <div class="row">
					<div class="col s12 offset-m2 m8 offset-l3 l6 card-panel hoverable">
						<form id="form_url_short2" action="">
							<div style="padding-bottom: 8px;">
								<h5>
									<i class="material-icons">short_text</i> Get the Long URL
								</h5>
							</div>
							<div class="input-field">
								<i class="material-icons prefix">link</i>            
								<input id="inp_url2" placeholder="Short URL">
								<!-- <label for="inp_url">Long url</label> -->
							</div>
							<div class="right-align">
								<button
									class="btn-small waves-effect waves-light"
									type="submit" 
                                    
								>
									Get Long Url
									<i class="material-icons right">send</i>
								</button>
							</div>
                            <div id="result2" ></div>

							<div class="left-align" >
								<!-- <div > -->
									<!-- <i class="fa fa-facebook icon"></i>  -->
									<!-- <i class="material-icons right">content_copy</i> -->
							<div class="btn-small waves-effect waves-light">
							<input
							type="button" id="btns"
								
								value="Copy" class=" waves-light"
								
								
							>
							<i class="material-icons right">content_copy</i>
						</div>
								
								
							<!-- </button> -->
						<!-- </div> -->
						</div>
                        
                            

							
							
						</form> 
						
						
					</div>
				</div>

               

               
    
                   
				<div class="row">
					<div class="col s12 offset-m2 m8 offset-l3 l6 card-panel hoverable">
						<div class="top">
							<div style="padding-bottom: 8px;">
								<h5><i class="material-icons">history</i>History</h5>
							</div>

							
							<div id="result_top-redishorts" ></div>

						</div>
					</div>
				</div>


			</div>
			

		</main>


		<footer class="page-footer">
			<div class="container">
				<div class="row">
					<div class="col m8 s12">
						<h4 class="white-text">URL Shortner</h4>
						<p class="grey-text text-lighten-4 flow-text">
							Made with <i class="material-icons">favorite</i> by Asish
						</p>
					</div>
					<div class="col m3 offset-m1 s12">
						<h5 class="white-text">Links</h5>
						<ul>
							<li>
								<h6>
									<a
										class="grey-text text-lighten-3"
										href="https://github.com/aku019"
										target="_blank"
										><i class="fab fa-github"></i> Github</a
									>
								</h6>
							</li>
							<li>
								<h6>
									<a
										class="grey-text text-lighten-3"
										href="https://www.linkedin.com/in/asish-kumar-upadhyay-971478142/"
										target="_blank"
										><i class="fab fa-linkedin"></i> Linkedin</a
									>
								</h6>
							</li>
							<li>
								<h6>
									<a
										class="grey-text text-lighten-3"
										href="https://twitter.com/AsishkumarUpad2"
										target="_blank"
										><i class="fab fa-twitter"></i> Twitter</a
									>
								</h6>
							</li>
							<li>
								<h6>
									<a
										class="grey-text text-lighten-3"
										href="https://www.facebook.com/asishkrupadhyay/"
										target="_blank"
										><i class="fab fa-facebook"></i> Facebook</a
									>
								</h6>
							</li>
							<li>
								<h6>
									<a
										class="grey-text text-lighten-3"
										href="https://drive.google.com/file/d/1h5Sj2p5vPX53avlZoQFIfAl8eGnzPioz/view"
										target="_blank"
										><i class="fas fa-file"></i> Resume</a
									>
								</h6>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</footer>
<script>
    
    function begin() {
                // const shortid=requ  ire('shortid');
				const inpUrl = document.getElementById("inp_url");
                const inpUrl2 = document.getElementById("inp_url2");
				const formUrlShort = document.getElementById("form_url_short");
                const formUrlShort2 = document.getElementById("form_url_short2");
				const divResult = document.getElementById("result");
                const divResult2 = document.getElementById("result2");
				const shortLoad = document.getElementById("loading-short");
				const topShortLoad = document.getElementById("loading-top-short");
				const resultTopRedis = document.getElementById("result_top-redishorts");
                const res = document.getElementById("btns");
				const res2 = document.getElementById("btns2");
				fetch('/api/urls').
                then(response => response.json())
                .then(
                users=>{
                const usersElement =document.querySelector('#result_top-redishorts');
				//const ele=document.createElement('div');
				// ele.innerHTML="Log url";
               // usersElement.appendChild(ele);
				
                users.forEach(user => {
                   const element=document.createElement('div');
                    console.log(user);
					let hashUrl = user.id;
							// if (hash.shortUrl !== "*")
							// 	hashUrl = window.location.host + "/" + hash.shortUrl;

							// Hide the progress bar
							// shortLoad.classList.add("hide");
							// Append the short url into the page

							const resultHtml = `<h6 class="truncate">Long url: <a href="${user.long_url}" target="_blank">${user.long_url}</a></h6><h6>Short url: <a href="${
								`${document.location.origin}` +'/u/'+ hashUrl
							}" target="_blank">${
								`${document.location.origin}` +'/u/'+ hashUrl
							}</a></h6>\n`;
                    element.innerHTML=resultHtml;
                    usersElement.appendChild(element);


            
        });

    
});


				// Get the short url for the input url and display both
				function shortenUrl(e) {
					e.preventDefault();

					// Requested url
					const url = inpUrl.value;
					if (url == undefined || url == null || url === "") return;

					// Remomve previous results if any
					divResult.innerHTML = "";
					// Show the progress bar
					// shortLoad.classList.remove("hide");

					// Get the short url for the input url
					fetch("/api/urls", {
						method: "post",
						body: JSON.stringify({ long_url:url }),
						headers: {
							"Content-Type": "application/json",
						},
					})
						.then((res) => res.json())
						.then((urls) => {
							// generate the shortened url
							let hashUrl = urls.id;
							// if (hash.shortUrl !== "*")
							// 	hashUrl = window.location.host + "/" + hash.shortUrl;

							// Hide the progress bar
							// shortLoad.classList.add("hide");
							// Append the short url into the page

							const resultHtml = `<h6 class="truncate">Long url: <a href="${url}" target="_blank">${url}</a></h6><h6>Short url: <a href="${
								`${document.location.origin}` +'/u/'+ hashUrl
							}" target="_blank">${
								`${document.location.origin}` +'/u/'+ hashUrl
							}</a></h6>`;

							divResult.innerHTML = resultHtml;
                            inpUrl.value = "";
							res2.addEventListener('click',() => {
                       const copyText = `${document.location.origin}` +'/u/'+ hashUrl;
					   navigator.clipboard.writeText(copyText).then(function() {
						alert(`Copied the text`);
                   }, function(err) {
					alert(`Copy failed`);
                      });
                    //    copyText.select();
                    //    document.execCommand('copy');
                    //    alert(`Copied the text: ${longurl}`);
                    //    divResult2.innerHTML="00";
                  
                });
                //             document.getElementById("bt").addEventListener('click', () => {

                //       const copyText = document.querySelector('#result');
                //        copyText.select();
                //        document.execCommand('copy');
                //        alert(`Copied the text: ${copyText.innerHTML}`);
                // });

							// Clear the input
							
						});
				}
                function longUrl(e) {
					e.preventDefault();
                    divResult2.innerHTML = "";
					const local_url=document.location.origin;
                    let url = new URL('/api/urls/', local_url);
                    //inpUrl2
                    const param = { id: inpUrl2.value };
    //                 Object.keys(param).forEach((key) => {
    //     url.append(key, param[key]);
    // });
    // url.search = new URLSearchParams(param).toString();
	const len=document.location.origin.length;
    url=url+inpUrl2.value.substring(len+3);
    console.log(url);
    fetch(url)
        .then((response) => response.json())
        .then((json) => {
            
                const shorturl = json.id;
                const longurl = json.long_url;
                console.log(json);
                const resultHtml = `<h6 class="truncate">Long url: <a href="${longurl}" target="_blank">${longurl}</a></h6>`
                divResult2.innerHTML =resultHtml;
                res.addEventListener('click',() => {
                       const copyText = `${longurl}`;//document.getElementById("result2");
					   navigator.clipboard.writeText(copyText).then(function() {
						alert(`Copied the text: ${longurl}`);
                   }, function(err) {
					alert(`Copy failed`);
                      });
                    //    copyText.select();
                    //    document.execCommand('copy');
                    //    alert(`Copied the text: ${longurl}`);
                    //    divResult2.innerHTML="00";
                  
                });
                
                
            
        });
					
				
				}

                
                formUrlShort2.addEventListener("submit", longUrl);
				// Listern for user request to shorten ur;
          
				formUrlShort.addEventListener("submit", shortenUrl);
				
			}

			document.addEventListener("DOMContentLoaded", begin);
				

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>

    </body>
    </html>